#+begin_src c
/* This version of DEFUN declares a function prototype with the right
   arguments, so we can catch errors with maxargs at compile-time.  */
#define DEFUN(lname, fnname, sname, minargs, maxargs, intspec, doc) \
  SUBR_SECTION_ATTRIBUTE                                            \
  static union Aligned_Lisp_Subr sname =                            \
     {{{ PVEC_SUBR << PSEUDOVECTOR_AREA_BITS },			    \
       { .a ## maxargs = fnname },				    \
       minargs, maxargs, lname, {intspec}, lisp_h_Qnil}};	    \
   Lisp_Object fnname
#+end_src

#+begin_src lisp
(def-cop defsubr (form)
  ;; TODO bind list FORM with (lname fnname sname minargs maxargs intspec doc body)
  |subr-section-attribute|
  (declare :static
           (sname (:union |Aligned-Lisp-Subr|))
           (struct
            (struct
             (struct (<< |pvec-subr| |psudovector-area-bits|))
             (struct (set (## .a maxargs) fname))
             minargs
             maxargs
             lname
             (struct intspec)
             |lisp-h-Qnil|
             )))
  (defun (fnname |:lisp-object|)
    body))
#+end_src
